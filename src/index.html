<!DOCTYPE html>
<html>
  <head>
    <title>AiRA</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" rel="stylesheet">
    <link rel = "stylesheet" href = "css/styles.css">
    <link rel = "manifest"  href ="manifest.json">
    <link rel="stylesheet" type="text/css" href="./style.css"/>
    <link rel="apple-touch-icon" href="img/dark_maskable_icon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#66baff">
    <script src="./index.js"></script>
    <script src="./api.js"></script>
    <script src="./event.js"></script>
  </head>

  <body style="margin: 0;"></body>

  <body>
        <!-- Navigation bar -->
        <header class = "navbar">
            <div class = "container-fluid">
                <span>
                    <img class = "aira" src = "img/AiRA_dark_512.png">
                </span>
                <div class = "float-end">
                    <button class = "nobutton">
                        <i class="fa-solid fa-magnifying-glass fa-xl"></i>
                    </button>
                    <button class = "nobutton">
                        <i class="fa-solid fa-user fa-xl"></i>
                    </button>
                    <button class = "nobutton nav__toggle">
                        <i class="fa-solid fa-bars fa-xl"></i>
                    </button>
                </div>
            </div>
            
        </header>

    <!--The div element for the map -->
    <div id="map"></div>

    <style>
    #map{
        height:90vh;
        width: 100vw;
    }
    </style>
    <script>
        function initMap(){
            var options = {
                zoom:11,
                center:{lat:35.9132, lng:-79.0558} 
            }
            var map = new google.maps.Map(document.getElementById('map'), options);

            //Create markers
            const icons = {

            }
            //Extract data from API test
            // api url

            //Uncomment to use the api link
            const api_url = 
                "https://api.purpleair.com/v1/groups/954/members?fields=latitude%2Clongitude%2Cpm2.5_cf_1&api_key=6690E52E-B5BF-11EC-B330-42010A800004";
            
            // Defining async function
            async function getapi(url) {
                
                // Storing response
                const response = await fetch(url)
                // Storing data in form of JSON
                var dataJS = await response.json()

                const {data} = dataJS;
                // Access the first element of the array within the json from the api_url
                for(let i = 0; i < data.length; i++) {
                    var color;
                    if(data[i][3] <= 12.0 ){
                        color = "#00CC00"
                    } else if(data[i][3] <= 35.4) {
                        color = "#FFFF00"
                    } else if(data[i][3] <= 55.4) {
                        color = "#EB8A14"
                    } else if(data[i][3] <= 150.4) {
                        color = "#FF0000"
                    } else if(data[i][3] <= 250.4) {
                        color = "#A10649"
                    } else {
                        color = "#7E0023"
                    } 
                    const marker = new google.maps.Marker({
                        position: new google.maps.LatLng(data[i][1], data[i][2]),
                        icon: {
                            path: google.maps.SymbolPath.CIRCLE,
                            scale: 12,
                            fillColor: color,
                            fillOpacity: 0.7,
                            strokeWeight: 0.4
                        },
                        map: map,
                        label: {color: '#000', fontSize: '12px', fontWeight: '600',text: data[i][3].toString()},
                    });
                    // marker.addListener("click", () => {
                    //     //Add click event for sidebar
                    // });   
                }
            }
            getapi(api_url); 
        }
    </script>
    <!-- Async script executes immediately and must be after any DOM elements used in callback. -->
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBTFuBXBXmmLPDVnjWngXa8cwOMzLYBSfk&callback=initMap"
      async
    ></script>

    <!--<p>
        Time_stamp: <span id = "time"></span> <br />
        latitude: <span id = "lat"></span> <br />
        longitude: <span id = "lon"></span>
    </p>-->

    <script src = "api.js"></script>
    <script>
        if('serviceWorker' in navigator){
            window.addEventListener('load',()=>{
                navigator.serviceWorker.register('/sw.js');
            });
        }
    </script>
  </body>
</html>






<!-- 
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ARA Beta Map Project</title>
        <style>
            #map{
                height:900px;
                width:100%;
            }
        </style>
    </head>
    <body>
        <h1>Map</h1>
        <div id="map"></div>
        <script>
            function initMap(){
                var options = {
                    zoom:8,
                    center:{lat:34.621472, lng:-79.006103} 
                }
                var map = new google.maps.Map(document.getElementById('map'), options);
            }
        </script>
        <script async
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBnZr3431Bp64wfHCllEyMGeEVz-_fG49s&callback=initMap">
        </script>
    </body>
</html>  -->